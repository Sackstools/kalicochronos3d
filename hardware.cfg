# =====================================================================
# hardware.cfg - Configuração de Hardware (Motores, Drivers, Sondas)
# =====================================================================
# Este arquivo define os componentes físicos do sistema de movimento.

# --- Eixo X ---
[stepper_x]
step_pin: PB13
dir_pin: !PB12
enable_pin: !PB14
microsteps: 16
# Uso do 'step_distance' (recurso Bleeding-Edge) para maior precisão.
# Fórmula: rotation_distance / (full_steps_per_rotation * microsteps)
# Exemplo para rotation_distance=40, motor 1.8° (200), 16 microsteps:
# 40 / (200 * 16) = 0.0125
step_distance: 0.0125
endstop_pin: ^PC0
position_endstop: 350
position_max: 350
homing_speed: 100

[tmc2209 stepper_x]
uart_pin: PC4
run_current: 0.900
hold_current: 0.700
stealthchop_threshold: 999999 # Desativado para torque máximo em alta velocidade

# --- Eixo Y ---
[stepper_y]
step_pin: PB10
dir_pin: !PB2
enable_pin: !PB11
microsteps: 16
step_distance: 0.0125
endstop_pin: ^PC1
position_endstop: 350
position_max: 350
homing_speed: 100

[tmc2209 stepper_y]
uart_pin: PC5
run_current: 0.900
hold_current: 0.700
stealthchop_threshold: 999999

# --- Eixo Z (4 Motores para Quad Gantry Leveling) ---
[stepper_z]
step_pin: PB1
dir_pin: !PB0
enable_pin: !PC3
microsteps: 16
# Exemplo para fuso com rotation_distance=8:
# 8 / (200 * 16) = 0.0025
step_distance: 0.0025
endstop_pin: probe:z_virtual_endstop # Usa a sonda para o home virtual
position_max: 320
position_min: -5

[tmc2209 stepper_z]
uart_pin: PC7
run_current: 0.800

[stepper_z1]
step_pin: PA10
dir_pin: !PA14
enable_pin: !PA15
microsteps: 16
step_distance: 0.0025

[tmc2209 stepper_z1]
uart_pin: PF1
run_current: 0.800

[stepper_z2]
step_pin: PE10
dir_pin: !PE9
enable_pin: !PE8
microsteps: 16
step_distance: 0.0025

[tmc2209 stepper_z2]
uart_pin: PE7
run_current: 0.800

[stepper_z3]
step_pin: PE14
dir_pin: !PE13
enable_pin: !PE12
microsteps: 16
step_distance: 0.0025

[tmc2209 stepper_z3]
uart_pin: PE11
run_current: 0.800

# --- Motor da Extrusora (Fase 2 do Plano Bleeding-Edge) ---
# A lógica térmica e de fluxo fica em thermals.cfg.
# Esta separação é a chave para a extrusão sincronizada.
[extruder_stepper]
extruder: extruder # Vincula este motor à lógica [extruder]
step_pin: tool_head:PA5
dir_pin: !tool_head:PA6
enable_pin: !tool_head:PA4
microsteps: 16
# Para extrusoras, a calibração empírica de rotation_distance é comum.
# O step_distance pode ser usado se o percurso do filamento for conhecido com precisão.
rotation_distance: 22.67895 # Exemplo para uma extrusora BMG
# Calibração fina será feita via comando ROTATION_DISTANCE_CALIBRATION

# --- Sondas e Sensores de Movimento ---
[adxl345]
# Acelerômetro na toolhead para calibração do Input Shaper
cs_pin: tool_head:PA15
spi_bus: spi1

[bltouch]
sensor_pin: ^tool_head:PB8
control_pin: tool_head:PB9
x_offset: 0
y_offset: 25
# z_offset será calibrado via comando PROBE_CALIBRATE e salvo com SAVE_CONFIG.
