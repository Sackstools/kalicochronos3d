# =====================================================================
# hardware-btt-octopus-max-ez.cfg - Definições de Hardware (CORRIGIDO)
# =====================================================================
# Contém a configuração de todos os motores, drivers e sensores de hardware.

# --- Eixo X (Motor Duplo) ---
[stepper_x]
step_pin: PC13
dir_pin: !PC14
enable_pin: !PE6
full_steps_per_rotation: 400 # Motor de 0.9 graus
# step_distance para correia GT2 com polia 20T = 40 / (400 * 16) = 0.00625
step_distance: 0.00625
endstop_pin: ^PF0
position_endstop: 0
position_max: 600
homing_speed: 100
high_precision_step_compress: True

[tmc5160 stepper_x]
cs_pin: PG14
spi_bus: spi4
run_current: 2.2
# Motores de 3A, configurado para 2.2A para segurança e menor aquecimento.
# Verifique o aquecimento do motor e do driver. Pode ser aumentado se a refrigeração permitir.
stealthchop_threshold: 999999 # Força o modo SpreadCycle para torque máximo.

[stepper_x1]
step_pin: PE4
dir_pin: !PE5
enable_pin: !PE3
full_steps_per_rotation: 400
step_distance: 0.00625
endstop_pin: ^PF2
high_precision_step_compress: True

[tmc5160 stepper_x1]
cs_pin: PG13
spi_bus: spi4
run_current: 2.2
stealthchop_threshold: 999999

# --- Eixo Y (Motor Duplo) ---
[stepper_y]
step_pin: PE1
dir_pin: !PE0
enable_pin: !PE2
full_steps_per_rotation: 400
step_distance: 0.00625
endstop_pin: ^PF4
position_endstop: 0
position_max: 600
homing_speed: 100
high_precision_step_compress: True

[tmc5160 stepper_y]
cs_pin: PG12
spi_bus: spi4
run_current: 2.2
stealthchop_threshold: 999999

[stepper_y1]
step_pin: PB8
dir_pin: !PB9
enable_pin: !PB7
full_steps_per_rotation: 400
step_distance: 0.00625
endstop_pin: ^PF3
high_precision_step_compress: True

[tmc5160 stepper_y1]
cs_pin: PG11
spi_bus: spi4
run_current: 2.2
stealthchop_threshold: 999999

# --- Eixo Z (Motor Principal para Z-Tilt) ---
# Os motores Z1 e Z2 são definidos automaticamente pelo módulo [z_tilt]
# e usarão os pinos de Motor6 (PG15,PB3,PD5) e Motor7 (PD3,PD2,PD4).
[stepper_z]
step_pin: PB5
dir_pin: !PB4
enable_pin: !PB6
full_steps_per_rotation: 400
# step_distance para fuso T8*8 = 8 / (400 * 16) = 0.00125
step_distance: 0.00125
position_max: 800
position_min: -5
high_precision_step_compress: True
# O endstop do Z é a sonda, definida na seção [probe]
endstop_pin: probe:z_virtual_endstop

[tmc5160 stepper_z]
cs_pin: PG10
spi_bus: spi4
run_current: 2.0
stealthchop_threshold: 999999


# --- Motor da Extrusora ---
[extruder_stepper]
extruder: extruder
step_pin: PA10
dir_pin: !PA9
enable_pin: !PA15
full_steps_per_rotation: 400
# A rotation_distance da extrusora deve ser calibrada empiricamente.
rotation_distance: 22.67895 # Exemplo para uma extrusora BMG
microsteps: 16
high_precision_step_compress: True

[tmc5160 extruder_stepper]
cs_pin: PD6
spi_bus: spi4
run_current: 1.0 # Corrente mais baixa para extrusora
stealthchop_threshold: 999999


# --- Sonda Z ---
[probe]
# Configuração de sonda genérica. Substitua pelo seu tipo de sonda (ex: [bltouch]).
pin: ^PB15
x_offset: 0
y_offset: 0
z_offset: 0 # DEVE ser calibrado com PROBE_CALIBRATE
speed: 10
samples: 3
samples_result: median
sample_retract_dist: 2.0
samples_tolerance: 0.01
samples_tolerance_retries: 3
